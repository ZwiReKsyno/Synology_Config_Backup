# Резервное копирование конфигурации Synology
 Создайте резервную копию и экспортируйте конфигурацию Synology DSM.

### Описание

Это сценарий bash для резервного копирования конфигурации системы Synology и, при необходимости, копирования ее через SCP на другой сервер.

Работает в DSM 7 и DSM 6.

#### Что делает скрипт:

* Получает имя хоста Synology и дату использования в имени файла резервной копии.
  * Имя хоста Synology включается в имя файла резервной копии на случай, если у вас несколько Synology.
* Проверяет, что скрипт работает от имени пользователя root.
* Проверяет, существует ли указанное вами хранилище резервных копий.
* Экспортирует конфигурацию системы в указанную папку.
* Если REMOTE_BACKUP=yes копирует резервную копию на указанный удаленный сервер.

**Пример автоматически создаваемого имени файла резервной копии::** DISKSTATION_2022-11-07_0600.dss

### Скачать сценарий

1. Загрузите исходный код последней версии zip https://github.com/007revad/Synology_Config_Backup/releases
2. Сохраните загруженный zip-файл в папку на Synology.
3. Разархивируйте zip-файл.

### Настройки

Вам необходимо установить TARGET_DIR= в верхней части скрипта (под заголовком). Установите его в место, где вы хотите сохранить резервную копию.

Вам также необходимо установить для REMOTE_BACKUP= значение «да», если вы хотите скопировать резервную копию на удаленный сервер.

**Пример:**

```YAML
TARGET_DIR="/volume1/Backups/NAS_System_Backups/DiskStation"
REMOTE_BACKUP=yes
```

#### Дополнительные настройки для копирования резервной копии на удаленный сервер

Если вы установили REMOTE_BACKUP=yes, вам также необходимо установить REMOTE_PORT, REMOTE_IP, REMOTE_DIR, LOCAL_USER и REMOTE_USER в соответствии с вашими настройками.

**Пример:**

```YAML
REMOTE_PORT=22
REMOTE_IP=192.168.0.100
REMOTE_DIR="/volume1/Backups/NAS_System_Backups/DiskStation"
LOCAL_USER=Bob
REMOTE_USER=Bob
```

Если вы установили REMOTE2_BACKUP=yes, вам также необходимо установить REMOTE2_PORT, REMOTE2_IP, REMOTE2_DIR, LOCAL2_USER и REMOTE2_USER в соответствии с вашими настройками.

**Пример:**

```YAML
REMOTE2_PORT=22
REMOTE2_IP=192.168.0.111
REMOTE2_DIR="/volume1/Backups/NAS_System_Backups/DiskStation"
LOCAL2_USER=Bob
REMOTE2_USER=Ted
```

### Требования

Если вы хотите запланировать автоматический запуск сценария и позволить сценарию копировать резервную копию на другой сервер, вам необходимо настроить ключи SSH, чтобы SCP мог получить доступ к удаленному серверу без ввода пароля пользователя.

См. https://blog.golimb.com/2020/10/03/synology-ssh-key-authentication/ чтобы узнать, как настроить аутентификацию по ключу SSH.

**Примечание.** 
**этот сценарий необходимо запускать от имени пользователя root или запланировать запуск от имени пользователя root .**.
